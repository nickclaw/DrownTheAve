doctype html
html
    head
        title #{special.name}

    body
        h2 #{special.id} - #{special._bar_id.name}
        a(href="/admin/specials") back

        form(method="POST" action="")
            label bar
            select(name="_bar_id")
                each bar in bars
                    if bar.id === special._bar_id.id
                        option(value=bar.id selected) #{bar.name}
                    else
                        option(value=bar.id) #{bar.name}
            br

            label deal
            textarea(name="deal")
            br

            label start
            input(name="start")
            br

            label end
            input(name="end")
            br

            label dates
            each date in special.dates
                label year
                input(name="dates[year]" data-type="year")
                label month
                input(name="dates[month]" data-type="month")
                label date
                input(name="dates[date]" data-type="date")
                label day
                input(name="dates[day]" data-type="day")
                a(href="#" class="delete") -
                br

            a(href="#" class="add") +
            br
            input(type="submit" value="edit")

            script.
                window.addEventListener('load', function() {
                    document.body.addEventListener('click', function(evt) {
                        if (evt.target.tagName !== 'A') return;

                        if (evt.target.classList.contains('add')) {
                            evt.preventDefault();
                            evt.target.insertAdjacentHTML('beforebegin', '<label>year</label><input name="dates[year]" data-type="year" /><label>month</label><input name="dates[month]" data-type="month" /><label>date</label><input name="dates[date]" data-type="date" /><label>day</label><input name="dates[day]" data-type="day" /><a href="#" class="delete">-</a><br />');
                        } else if (evt.target.classList.contains('delete')) {
                            evt.preventDefault();
                            var form = document.querySelector('form');
                            for (var i = 0; i < 8; i++) {
                                form.removeChild(evt.target.previousSibling);
                            }
                            form.removeChild(evt.target.nextSibling);
                            form.removeChild(evt.target);
                        }
                    });

                    document.querySelector('form').addEventListener('submit', function(evt) {
                        ['year', 'month', 'date', 'day'].forEach(function(type) {
                            var years = document.querySelectorAll('input[data-type='+type+']'),
                                count = 0;
                            [].forEach.call(years, function(el) {
                                el.setAttribute('name', el.getAttribute('name') + '['+(count++)+']');
                            });
                        });
                    });
                });
